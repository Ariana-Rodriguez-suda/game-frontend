<div class="level-container">

  <!-- HUD y Personaje -->
  <div class="game-area">
    <div class="character" #character></div>
    <div class="platform"></div>

    <!-- Monedas en el mapa -->
    <div 
      class="coin" 
      *ngFor="let moneda of monedasMapa" 
      [style.left.px]="moneda.x">
      ğŸª™
    </div>

    <!-- NPC visible en el mapa -->
    <div class="npc" [style.left.px]="npcPosition.x">ğŸ§™â€â™‚ï¸</div>
    <div class="npc" style="left: 800px; bottom: 0;">ğŸ§“</div>
  </div>

  <!-- Mensajes -->
  <div class="message-box">
    <p *ngFor="let msg of messages">{{ msg }}</p>
  </div>

  <!-- BotÃ³n para activar modo suma -->
  <div class="controls">
    <button (click)="activarModoSuma()" [attr.aria-pressed]="mode === 'suma'">
      Activar Modo Suma
    </button>
  </div>

  <!-- Bloques -->
  <div class="blocks-area">
    <div 
      class="block" 
      *ngFor="let block of blocks" 
      [attr.data-id]="block.id"
      (click)="empujarBloque(block.id)"
      role="listitem"
      tabindex="0"
      [attr.aria-label]="'Bloque con fracciÃ³n ' + block.numerator + ' sobre ' + block.denominator">

      <div class="block-fraction">
        <div 
          class="block-part" 
          *ngFor="let part of [].constructor(block.denominator); let i = index"
          [class.filled]="i < block.numerator">
        </div>
      </div>

      <span class="fraction-label">{{ block.numerator }}/{{ block.denominator }}</span>
    </div>
  </div>

  <!-- Ãrea de fusiÃ³n -->
  <div class="fusion-area" *ngIf="mode === 'suma'">
    <h3>Selecciona dos bloques para sumar</h3>
    <input type="number" placeholder="ID Bloque 1" #id1>
    <input type="number" placeholder="ID Bloque 2" #id2>
    <button (click)="fusionarBloques(+id1.value, +id2.value)">Sumar</button>
  </div>

  <!-- Pantalla final -->
  <div *ngIf="nivelCompletado" class="final-screen">
    <h2>Â¡Nivel completado!</h2>
    <p>Estrellas: {{ estrellasGanadas }}</p>
    <app-hud [coins]="coins" [level]="1"></app-hud>
    <app-button (click)="avanzar()">Siguiente nivel</app-button>
  </div>

</div>
