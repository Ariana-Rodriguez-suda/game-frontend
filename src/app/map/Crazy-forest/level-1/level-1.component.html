<div class="level-container">
  <div class="game-area" #gameArea>
    <div class="world" [style.width.px]="worldWidth" [style.transform]="'translateX(-' + scrollX + 'px)'">

      <!-- HUD -->
      <div class="hud-top">
        🧡 Vida: 3 | 🪙 Monedas: {{ coinsCollected }}
      </div>

      <!-- Plataformas -->
      <div *ngFor="let platform of platforms"
           class="platform"
           [style.left.px]="platform.x"
           [style.bottom.px]="platform.y"
           [style.width.px]="platform.width"
           [style.height.px]="platform.height">
      </div>

      <!-- Agujero (representa visualmente el puente roto) -->
      <div class="platform hole" 
           [style.left.px]="bridge.x" 
           [style.width.px]="bridge.width"
           [style.bottom.px]="0">
      </div>

      <!-- Bloque de introducción -->
      <div *ngFor="let block of introBlocks"
           class="block"
           [id]="'block-' + block.id"
           [style.left.px]="block.x - scrollX"
           [style.bottom.px]="getPlatformHeightAt(block.x)"
           tabindex="0"
           role="button"
           (click)="empujarBloque(block.id)"
           [attr.aria-label]="'Bloque con fracción ' + block.numerator + '/' + block.denominator">

        <div class="block-fraction">
          <div *ngFor="let i of [].constructor(block.denominator); let idx = index"
               class="block-part"
               [class.filled]="idx < block.numerator"></div>
        </div>
        <span class="fraction-label">{{ block.numerator }} / {{ block.denominator }}</span>
      </div>

      <!-- Personaje -->
      <div #character class="character"></div>

      <!-- NPC en el puente -->
      <div class="npc"
           [style.left.px]="npcX - scrollX"
           [style.bottom.px]="npcY"
           tabindex="0"
           aria-label="NPC en el puente">🧙‍♂️</div>

      <!-- Monedas -->
      <div *ngFor="let coin of coins"
           class="coin"
           [style.left.px]="coin.x - scrollX"
           [class.collected]="coin.collected">🪙</div>

      <!-- Mensajes -->
      <div class="message-box">
        <p *ngFor="let msg of messages">{{ msg }}</p>
      </div>
    </div>
  </div>

  <!-- Botón modo suma -->
  <div class="controls">
    <button (click)="activarModoSuma()" [attr.aria-pressed]="mode === 'suma'">
      {{ mode === 'suma' ? 'Desactivar' : 'Activar' }} Modo Suma (tecla S)
    </button>
  </div>

  <!-- Pantalla final -->
  <div *ngIf="nivelCompletado" class="final-screen" role="dialog" aria-modal="true">
    <h2>¡Nivel completado!</h2>
    <p>Estrellas: {{ estrellasGanadas }}</p>
    <app-hud [coins]="coinsCollected" [level]="1"></app-hud>
    <app-button (click)="avanzar()">Siguiente nivel</app-button>
  </div>
</div>
